<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 700" width="1400" height="700">
  <defs>
    <style>
      .node-circle { fill: #4A9EDF; }
      .node-circle-small { fill: #4A9EDF; }
      .decision-diamond { fill: #F5B7B1; stroke: #E74C3C; stroke-width: 1; }
      .pydantic-box { fill: white; stroke: #888; stroke-width: 1.5; stroke-dasharray: 5,3; }
      .inner-box { fill: #F8F9FA; stroke: #DEE2E6; stroke-width: 1; rx: 3; }
      .arrow { stroke: #666; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
      .arrow-back { stroke: #999; stroke-width: 1; fill: none; stroke-dasharray: 4,2; marker-end: url(#arrowhead-gray); }
      .label { font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; fill: #333; }
      .label-blue { font-family: 'Segoe UI', Arial, sans-serif; font-size: 13px; fill: #4A9EDF; font-weight: 500; }
      .label-small { font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; fill: #666; }
      .label-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 12px; fill: #333; font-weight: 500; }
      .label-decision { font-family: 'Segoe UI', Arial, sans-serif; font-size: 11px; fill: #666; }
      .icon-box { fill: #E8F4FD; stroke: #4A9EDF; stroke-width: 1; }
      .boost-label { font-family: 'Segoe UI', Arial, sans-serif; font-size: 10px; fill: #27AE60; font-weight: bold; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrowhead-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#999"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1400" height="700" fill="white"/>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-family="Segoe UI, Arial" font-size="18" font-weight="600" fill="#333">Maintenance Lessons Learned RAG System - Architecture Flow</text>

  <!-- ==================== INPUT SECTION ==================== -->

  <!-- Excel Files Icon -->
  <rect x="30" y="180" width="50" height="60" class="icon-box" rx="3"/>
  <text x="55" y="205" text-anchor="middle" font-size="20">üìä</text>
  <text x="55" y="225" text-anchor="middle" class="label-small">Excel</text>
  <text x="55" y="255" text-anchor="middle" class="label-blue" font-size="10">Lessons +</text>
  <text x="55" y="268" text-anchor="middle" class="label-blue" font-size="10">Jobs</text>

  <!-- Arrow from Excel to Data Processing -->
  <path d="M 80 210 L 110 210" class="arrow"/>

  <!-- ==================== DATA PROCESSING NODE ==================== -->

  <!-- Data Processing Node -->
  <circle cx="140" cy="210" r="18" class="node-circle"/>
  <text x="140" y="175" text-anchor="middle" class="label-blue">Data Processing</text>
  <text x="140" y="188" text-anchor="middle" class="label-small">(Node)</text>

  <!-- Arrow to Enrichment -->
  <path d="M 158 210 L 185 210" class="arrow"/>

  <!-- ==================== LLM ENRICHMENT PYDANTIC BOX ==================== -->

  <rect x="190" y="145" width="130" height="130" class="pydantic-box" rx="5"/>
  <text x="255" y="135" text-anchor="middle" class="label-title">Enriched Lesson</text>
  <text x="255" y="148" text-anchor="middle" class="label-small">Pydantic Object</text>

  <!-- Inner boxes for enrichment fields -->
  <rect x="200" y="165" width="110" height="22" class="inner-box"/>
  <text x="255" y="180" text-anchor="middle" class="label-small">specificity_level</text>

  <rect x="200" y="192" width="110" height="22" class="inner-box"/>
  <text x="255" y="207" text-anchor="middle" class="label-small">equipment_type</text>

  <rect x="200" y="219" width="110" height="22" class="inner-box"/>
  <text x="255" y="234" text-anchor="middle" class="label-small">lesson_scope</text>

  <rect x="200" y="246" width="110" height="22" class="inner-box"/>
  <text x="255" y="261" text-anchor="middle" class="label-small">confidence_score</text>

  <!-- LLM Enrichment Node -->
  <circle cx="255" cy="315" r="18" class="node-circle"/>
  <text x="255" y="345" text-anchor="middle" class="label-blue">LLM Enrichment</text>
  <text x="255" y="358" text-anchor="middle" class="label-small">(GPT-4o-mini)</text>

  <!-- Arrow from enrichment node to pydantic box -->
  <path d="M 255 297 L 255 275" class="arrow"/>

  <!-- Arrow from pydantic to confidence check -->
  <path d="M 320 210 L 355 210" class="arrow"/>

  <!-- ==================== CONFIDENCE CHECK ==================== -->

  <!-- Confidence Check Diamond -->
  <polygon points="385,210 405,190 425,210 405,230" class="decision-diamond"/>
  <text x="405" y="175" text-anchor="middle" class="label-small">Confidence</text>
  <text x="405" y="186" text-anchor="middle" class="label-small">Check?</text>

  <!-- High confidence path -->
  <path d="M 425 210 L 460 210" class="arrow"/>
  <text x="442" y="203" class="label-decision">High</text>

  <!-- Low confidence feedback loop -->
  <path d="M 405 230 L 405 315 L 273 315" class="arrow-back"/>
  <text x="340" y="308" class="label-decision">Low ‚Üí Re-enrich</text>

  <!-- ==================== INDEXING NODE ==================== -->

  <!-- Build Index Node -->
  <circle cx="490" cy="210" r="18" class="node-circle"/>
  <text x="490" y="175" text-anchor="middle" class="label-blue">Build Index</text>
  <text x="490" y="188" text-anchor="middle" class="label-small">(Node)</text>

  <!-- ChromaDB + BM25 boxes below -->
  <rect x="445" y="250" width="45" height="30" class="inner-box"/>
  <text x="467" y="269" text-anchor="middle" class="label-small">ChromaDB</text>

  <rect x="495" y="250" width="45" height="30" class="inner-box"/>
  <text x="517" y="269" text-anchor="middle" class="label-small">BM25</text>

  <!-- Arrows to storage -->
  <path d="M 480 228 L 467 250" class="arrow"/>
  <path d="M 500 228 L 517 250" class="arrow"/>

  <!-- ==================== JOB QUERY INPUT ==================== -->

  <!-- Job Query Input -->
  <rect x="30" y="400" width="50" height="50" class="icon-box" rx="3"/>
  <text x="55" y="425" text-anchor="middle" font-size="18">üîß</text>
  <text x="55" y="442" text-anchor="middle" class="label-small">Job</text>
  <text x="55" y="470" text-anchor="middle" class="label-blue" font-size="10">Job Query</text>

  <!-- Arrow to Multi-Tier Search -->
  <path d="M 80 425 L 115 425" class="arrow"/>

  <!-- ==================== MULTI-TIER RETRIEVAL PYDANTIC BOX ==================== -->

  <rect x="120" y="365" width="180" height="125" class="pydantic-box" rx="5"/>
  <text x="210" y="355" text-anchor="middle" class="label-title">Multi-Tier Retrieval</text>

  <!-- Tier boxes -->
  <rect x="130" y="378" width="160" height="22" class="inner-box"/>
  <text x="210" y="393" text-anchor="middle" class="label-small">Tier 1: Equipment-Specific</text>
  <text x="295" y="393" class="boost-label">√ó1.5</text>

  <rect x="130" y="405" width="160" height="22" class="inner-box"/>
  <text x="210" y="420" text-anchor="middle" class="label-small">Tier 2: Equipment-Type</text>
  <text x="295" y="420" class="boost-label">√ó1.2</text>

  <rect x="130" y="432" width="160" height="22" class="inner-box"/>
  <text x="210" y="447" text-anchor="middle" class="label-small">Tier 3: Generic/Universal</text>
  <text x="295" y="447" class="boost-label">√ó1.3</text>

  <rect x="130" y="459" width="160" height="22" class="inner-box"/>
  <text x="210" y="474" text-anchor="middle" class="label-small">Tier 4: Semantic Similarity</text>

  <!-- Hybrid Search Node -->
  <circle cx="210" cy="525" r="18" class="node-circle"/>
  <text x="210" y="555" text-anchor="middle" class="label-blue">Hybrid Search</text>
  <text x="210" y="568" text-anchor="middle" class="label-small">(Dense + Sparse)</text>

  <!-- Arrow from node to tiers -->
  <path d="M 210 507 L 210 490" class="arrow"/>

  <!-- Arrow from tiers to RRF -->
  <path d="M 300 425 L 340 425" class="arrow"/>

  <!-- ==================== RRF FUSION NODE ==================== -->

  <!-- RRF Fusion Node -->
  <circle cx="370" cy="425" r="18" class="node-circle"/>
  <text x="370" y="395" text-anchor="middle" class="label-blue">RRF Fusion</text>
  <text x="370" y="408" text-anchor="middle" class="label-small">(Node)</text>

  <!-- Arrow to Reranker -->
  <path d="M 388 425 L 430 425" class="arrow"/>

  <!-- ==================== RERANKER NODE ==================== -->

  <!-- Reranker Node -->
  <circle cx="460" cy="425" r="18" class="node-circle"/>
  <text x="460" y="395" text-anchor="middle" class="label-blue">Cross-Encoder</text>
  <text x="460" y="408" text-anchor="middle" class="label-small">Reranker (Node)</text>

  <!-- Arrow to Relevance Analysis -->
  <path d="M 478 425 L 520 425" class="arrow"/>

  <!-- ==================== RELEVANCE ANALYSIS PYDANTIC BOX ==================== -->

  <rect x="525" y="370" width="140" height="115" class="pydantic-box" rx="5"/>
  <text x="595" y="360" text-anchor="middle" class="label-title">Relevance Analysis</text>
  <text x="595" y="373" text-anchor="middle" class="label-small">Pydantic Object</text>

  <!-- Inner boxes -->
  <rect x="535" y="385" width="120" height="20" class="inner-box"/>
  <text x="595" y="399" text-anchor="middle" class="label-small">relevance_score</text>

  <rect x="535" y="409" width="120" height="20" class="inner-box"/>
  <text x="595" y="423" text-anchor="middle" class="label-small">technical_links</text>

  <rect x="535" y="433" width="120" height="20" class="inner-box"/>
  <text x="595" y="447" text-anchor="middle" class="label-small">safety_considerations</text>

  <rect x="535" y="457" width="120" height="20" class="inner-box"/>
  <text x="595" y="471" text-anchor="middle" class="label-small">match_reasoning</text>

  <!-- Relevance Analyzer Node -->
  <circle cx="595" cy="525" r="18" class="node-circle"/>
  <text x="595" y="555" text-anchor="middle" class="label-blue">AI Relevance</text>
  <text x="595" y="568" text-anchor="middle" class="label-small">(GPT-4o-mini)</text>

  <!-- Arrow from node to pydantic -->
  <path d="M 595 507 L 595 485" class="arrow"/>

  <!-- Arrow to Applicability Check -->
  <path d="M 665 425 L 710 425" class="arrow"/>

  <!-- ==================== APPLICABILITY CHECK NODE ==================== -->

  <!-- Applicability Checker Node -->
  <circle cx="740" cy="425" r="18" class="node-circle"/>
  <text x="740" y="395" text-anchor="middle" class="label-blue">Applicability</text>
  <text x="740" y="408" text-anchor="middle" class="label-small">Check (Node)</text>

  <!-- Arrow to Applicability Decision -->
  <path d="M 758 425 L 800 425" class="arrow"/>

  <!-- ==================== APPLICABILITY PYDANTIC BOX ==================== -->

  <rect x="805" y="365" width="145" height="125" class="pydantic-box" rx="5"/>
  <text x="877" y="355" text-anchor="middle" class="label-title">Applicability Result</text>
  <text x="877" y="368" text-anchor="middle" class="label-small">Pydantic Object</text>

  <!-- Inner boxes -->
  <rect x="815" y="380" width="125" height="20" class="inner-box"/>
  <text x="877" y="394" text-anchor="middle" class="label-small">decision (Yes/No/?)</text>

  <rect x="815" y="405" width="125" height="20" class="inner-box"/>
  <text x="877" y="419" text-anchor="middle" class="label-small">justification</text>

  <rect x="815" y="430" width="125" height="20" class="inner-box"/>
  <text x="877" y="444" text-anchor="middle" class="label-small">mitigation_applied</text>

  <rect x="815" y="455" width="125" height="20" class="inner-box"/>
  <text x="877" y="469" text-anchor="middle" class="label-small">risk_not_present</text>

  <rect x="815" y="480" width="125" height="20" class="inner-box"/>
  <text x="877" y="494" text-anchor="middle" class="label-small">key_factors</text>

  <!-- Arrow to Decision Diamond -->
  <path d="M 950 425 L 990 425" class="arrow"/>

  <!-- ==================== APPLICABILITY DECISION DIAMOND ==================== -->

  <!-- Decision Diamond -->
  <polygon points="1020,425 1050,395 1080,425 1050,455" class="decision-diamond"/>
  <text x="1050" y="375" text-anchor="middle" class="label-small">Applicable?</text>

  <!-- YES path -->
  <path d="M 1080 425 L 1130 425" class="arrow"/>
  <text x="1105" y="418" class="label-decision">Yes</text>

  <!-- NO path (down) -->
  <path d="M 1050 455 L 1050 520 L 1130 520" class="arrow"/>
  <text x="1060" y="490" class="label-decision">No</text>

  <!-- Cannot Determine path (up) -->
  <path d="M 1050 395 L 1050 340 L 1130 340" class="arrow"/>
  <text x="1060" y="365" class="label-decision">?</text>

  <!-- ==================== RESULTS DISPLAY ==================== -->

  <!-- Results - Applicable -->
  <rect x="1135" y="400" width="100" height="50" class="inner-box" style="fill: #D5F5E3; stroke: #27AE60;"/>
  <text x="1185" y="420" text-anchor="middle" font-size="16">‚úÖ</text>
  <text x="1185" y="438" text-anchor="middle" class="label-small" style="fill: #27AE60; font-weight: bold;">Applicable</text>

  <!-- Results - Not Applicable -->
  <rect x="1135" y="495" width="100" height="50" class="inner-box" style="fill: #FADBD8; stroke: #E74C3C;"/>
  <text x="1185" y="515" text-anchor="middle" font-size="16">‚ùå</text>
  <text x="1185" y="533" text-anchor="middle" class="label-small" style="fill: #E74C3C; font-weight: bold;">Not Applicable</text>

  <!-- Results - Cannot Determine -->
  <rect x="1135" y="315" width="100" height="50" class="inner-box" style="fill: #FCF3CF; stroke: #F39C12;"/>
  <text x="1185" y="335" text-anchor="middle" font-size="16">‚ö†Ô∏è</text>
  <text x="1185" y="353" text-anchor="middle" class="label-small" style="fill: #F39C12; font-weight: bold;">Cannot Determine</text>

  <!-- ==================== FINAL OUTPUT ==================== -->

  <!-- Arrows to final output -->
  <path d="M 1235 425 L 1280 425" class="arrow"/>
  <path d="M 1235 520 L 1260 520 L 1260 425 L 1280 425" class="arrow"/>
  <path d="M 1235 340 L 1260 340 L 1260 425 L 1280 425" class="arrow"/>

  <!-- Final Results Output -->
  <rect x="1285" y="385" width="90" height="80" class="icon-box" rx="5"/>
  <text x="1330" y="415" text-anchor="middle" font-size="24">üìã</text>
  <text x="1330" y="440" text-anchor="middle" class="label-title">Results</text>
  <text x="1330" y="455" text-anchor="middle" class="label-small">+ Export</text>

  <!-- ==================== LEGEND ==================== -->

  <rect x="1240" y="55" width="140" height="120" fill="#F8F9FA" stroke="#DEE2E6" rx="5"/>
  <text x="1310" y="75" text-anchor="middle" class="label-title">Legend</text>

  <!-- Node -->
  <circle cx="1260" cy="95" r="10" class="node-circle"/>
  <text x="1280" y="99" class="label-small">Processing Node</text>

  <!-- Decision -->
  <polygon points="1260,115 1270,105 1280,115 1270,125" class="decision-diamond"/>
  <text x="1290" y="119" class="label-small">Decision Point</text>

  <!-- Pydantic Box -->
  <rect x="1252" y="135" width="16" height="12" class="pydantic-box"/>
  <text x="1280" y="145" class="label-small">Pydantic Object</text>

  <!-- Arrow -->
  <path d="M 1255 160 L 1275 160" class="arrow"/>
  <text x="1290" y="164" class="label-small">Data Flow</text>

  <!-- ==================== LABELS FOR SECTIONS ==================== -->

  <!-- Section labels -->
  <text x="170" y="70" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" fill="#888" font-style="italic">Data Ingestion &amp; Enrichment</text>
  <rect x="20" y="80" width="530" height="260" fill="none" stroke="#E8E8E8" stroke-width="1" stroke-dasharray="3,3" rx="10"/>

  <text x="600" y="300" text-anchor="middle" font-family="Segoe UI, Arial" font-size="12" fill="#888" font-style="italic">Retrieval &amp; Analysis Pipeline</text>
  <rect x="20" y="310" width="1220" height="290" fill="none" stroke="#E8E8E8" stroke-width="1" stroke-dasharray="3,3" rx="10"/>

</svg>
